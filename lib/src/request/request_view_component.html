<div class="animated fadeIn">
  <div class="row cm-requests">
    <div class="col-xl-12">
      <div class="card">
        <div class="card-header">
            <i class="fa fa-files-o"></i> Заявка на проверку №{{ model.id }} от {{ model.createdAt | date:'d.MM.y' }}
            <span class="tag tag-pill" [ngClass]="resolveStatusStyleClass(model.statusSysName)">{{ model.statusName }}</span>
  
          <button *ngIf="statusSysName!='APPROVING' && canPublish()" type="button" class="btn btn-sm btn-success float-xs-right" (click)="publish()"><i class="icon-rocket"></i>&nbsp;
            Отправить на согласование
          </button>
          <button *ngIf="statusSysName=='APPROVING' && isCustomer() && canApprove()" type="button" class="btn btn-sm btn-success float-xs-right ml-1" (click)="done()"><i class="fa fa-check-square-o"></i>&nbsp;
            Одобрено
          </button>
          <button *ngIf="statusSysName=='APPROVING'  && isCustomer() && canSendToCorrect()" type="button" class="btn btn-sm btn-danger float-xs-right" (click)="correct()"><i class="fa fa-exclamation"></i>&nbsp;
            Отправить на исправление
          </button>
        </div>
        <div class="card-block py-0">

          <div class="row pl-1 pr-1 d-table-row">
            <div class="col-xl-2 col-md-3 d-100vh-va-top float-xl-none pr-2 py-1" style="border-right: 1px solid #d1d4d7;" sticky-top *ngIf="!listIsEmpty">
              <nav sticky>
                <contract-info-pane [contractId]="model.contractId" *ngIf="model.contractId != ''"></contract-info-pane>
                <div>
                  <div class="font-weight-bold mt-2">
                    <span class="text-uppercase mb-q">Работы</span>
                  </div>
                  <ul class="leaders font-xs mb-0">
                    <li><span>Выбрано работ</span> <span>{{ model.summary.worksQuantity }}</span></li>
                    <li><span>На сумму</span><span>{{ model.summary.worksAmount | cmFormatMoney | cmFormatCurrency:model.summary.currencySysName }}</span>
                    </li>
                  </ul>
                  <a *ngIf="!readOnly" [cmRouterLink]="['RequestModify']" class="font-xs">Изменить</a>
                </div>
                <div class="pb-2">
                  <div class="font-weight-bold mt-2">
                    <span class="text-uppercase mb-q">Итого</span>
                  </div>
                  <ul class="leaders font-xs mb-0">
                    <li><span>Общая стоимость</span>
                      <span>{{ model.summary.amount | cmFormatMoney | cmFormatCurrency:model.summary.currencySysName }}</span></li>
                    <li><span>В том числе НДС</span>
                      <span>{{ model.summary.vat | cmFormatMoney | cmFormatCurrency:model.summary.currencySysName }}</span></li>
                    <!--<li><span>Зачет аванса</span>
                      <span>{{model.summary.prepaidAmount}} {{model.summary.currencySysName}}</span></li>
                    <li><span>Удержано резерва</span> <span>{{model.summary.reserveAmount}} {{model.summary.currencySysName}}</span>
                    </li>-->
                    <li class="mt-1"><span class="font-weight-bold">Итого к оплате</span> <span
                      class="font-weight-bold">{{ model.summary.total | cmFormatMoney | cmFormatCurrency:model.summary.currencySysName }}</span></li>
                  </ul>
                  
                </div>
              </nav>
            </div>
            <!--./col-->

            <div class="card-block" *ngIf="listIsEmpty">
              <h4 class="text-muted">Для формирования списка первичных документов, сначала выберите <a [cmRouterLink]="['RequestModify', { 'id': requestId } ]">наряд-заказы</a></h4>
            </div>
            <div class="col-xl-10 col-md-9 d-100vh-va-top float-xl-none py-1 pl-2" *ngIf="!listIsEmpty">
              <h4>Ежемесячные табели учета рабочего времени</h4>
              <grid #grid [dataSource]="worksDataSource"
                    [tableStyleClass]="'table table-condensed table-striped table-hover table-bordered mt-1'">
                <grid-column width="3%">
                  <template let-work="rowData" grid-template="body">
                    <div class="text-md-center">
                      <button class="btn btn-tiny" (click)="goToDocument(work['id'])"><i class="icon-magnifier"></i></button>
                    </div>
                  </template>
                </grid-column>

                <grid-column header="Наименование" field="name" styleClass="text-md-center"></grid-column>
                <grid-column header="ФИО" field="assignee" styleClass="text-md-center"></grid-column>
                <grid-column header="Должность" field="position" styleClass="text-md-center"></grid-column>

                <grid-column header="Сумма" field="amount" width="11%" styleClass="text-md-center">,
                  <template let-work="rowData" grid-template="body">
                    <div class="text-md-right text-nowrap"> {{
                      work['amount'] | cmFormatMoney | cmFormatCurrency:work['currencyName'] }}
                    </div>
                  </template>
                </grid-column>
                <grid-column header="Статус" styleClass="text-md-center">
                  <template let-work="rowData" grid-template="body">
                    <div class="text-md-center"><span class="tag"
                      [ngClass]="resolveStatusStyleClass(work['statusSysName'])">{{ work['statusName'] }}</span>
                    </div>
                  </template>
                </grid-column>
              </grid>

            </div>
            <!--./col-->

          </div>
          <!--./row-->

        </div>
      </div>
    </div>
  </div>
</div>